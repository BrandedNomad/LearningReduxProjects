<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Todos and Goals</title>
</head>
<body>
    <div>
        <h1>To do</h1>
        <input id="todoInput" type="text" placeholder="Add Todo"/>
        <button id="todoBtn">Add Todo</button>
        <ul id="todoList"></ul>
    </div>
    <div>
        <h1>Goals</h1>
        <input id="goalInput" type="text" placeholder="Add goal"/>
        <button id="goalBtn">Add goal</button>
        <ul id="goalsList"></ul>
    </div>


    <script type="text/javascript">
        //library code

        //Store
        function createStore(reducer){

            let state
            let listeners = []

            //Getter methods
            const getState =()=>{
                return state
            }

            //Listening for state changes and informs user when state has changed
            const subscribe = (listener) =>{
                listeners.push(listener)
                return ()=>{
                    listeners = listeners.filter((l)=>{ //provides user with a way to unsubscribe from store
                        return l !== listener
                    })
                }

            }

            const dispatch = (action)=>{
                state = reducer(state,action)
                listeners.forEach((listener)=>{
                    listener()
                })
            }

            //Update State

            return {
                getState,
                subscribe,
                dispatch
            }
        }

        //App Code

        const ADD_TODO = 'ADD_TODO';
        const TOGGLE_TODO = 'TOGGLE_TODO';
        const REMOVE_TODO = 'REMOVE_TODO';
        const ADD_GOAL = 'ADD_GOAL';
        const REMOVE_GOAL='REMOVE_GOAL';

        function addToDoAction(todo){
            return {
                type:ADD_TODO,
                todo
            }
        }

        function toggleToDoAction(name){
            return {
                type:TOGGLE_TODO,
                todo:{
                    name
                }
            }
        }

        function removeToDoAction(name){
            return {
                type:REMOVE_TODO,
                todo:{
                    name
                }
            }
        }

        function addGoalAction(goal){
            return {
                type:ADD_GOAL,
                goal
            }
        }

        function removeGoalAction(name){
            return {
                type:REMOVE_GOAL,
                goal:{
                    name
                }
            }
        }

        //Reducer: takes in a state and a action and reduces it to a new state
        //Always a pure function
        function todos(state =[],action){ //initially state is undefined so need to set it's default

            switch(action.type){
                case ADD_TODO:
                    return state.concat([action.todo])
                case REMOVE_TODO:
                    return state.filter((todo)=>{
                        return todo.name !== action.todo.name
                    })
                case TOGGLE_TODO:
                    return state.map((todo)=>{
                        return todo.name !== action.todo.name ? todo:
                            Object.assign({},todo,{complete:!todo.complete})
                    })
                default:
                    return state
            }

        }

        //reducer
        function goals(state=[],action){

            switch(action.type){
                case ADD_GOAL:
                    return state.concat([action.goal])
                case REMOVE_GOAL:
                    return state.filter((goal)=>{
                        return goal.name !== action.goal.name
                    })
                default:
                    return state
            }
        }

        //reducer
        function app (state = {},action){
            return{
                todos:todos(state.todos,action),
                goals:goals(state.goals,action)
            }
        }

        const x = createStore(app)

        x.getState();

        const unsubscribe = x.subscribe(()=>{
            console.log('this new state is: ', x.getState())
        })

        x.dispatch(addToDoAction({id:0,name:'Go fish', complete:false}))

        x.dispatch(addToDoAction({ id:1, name:'Go for a walk',complete:false}))

        x.dispatch(addToDoAction({id:2,name:'Go for a icecream', complete:false}))

        x.dispatch(addGoalAction({ id:0, name:'Study Architecture'}))

        x.dispatch(toggleToDoAction('Go for a run'))

        x.dispatch(removeToDoAction('Go for a walk'))



    </script>

</body>
</html>